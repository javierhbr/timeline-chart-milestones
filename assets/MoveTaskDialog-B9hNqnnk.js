import{r as x,j as e,D as w,p as M,q as I,s as C,aF as f,u as S,L as N,v as F,B as v,X as L}from"./index-CfEYXZBA.js";import{S as B,a as E,b as O,c as V,d as W}from"./select-BNkLsDEQ.js";import{C as b}from"./circle-check-big-wQvsvjyk.js";import{C as q}from"./circle-alert-DUfNsyZ5.js";function G({isOpen:c,onClose:o,onConfirm:y,task:a,milestones:t,currentMilestoneId:n}){const[l,g]=x.useState(""),[m,u]=x.useState(!1);if(x.useEffect(()=>{if(a&&c){const s=t.filter(i=>i.milestoneId!==n);g(s.length>0?s[0].milestoneId:"")}},[a,c,n,t]),!a)return null;const d=t.find(s=>s.milestoneId===n),j=t.find(s=>s.milestoneId===l),h=t.filter(s=>s.milestoneId!==n),k=async()=>{if(!(!l||l===n)){u(!0);try{await y(n,l),o()}catch(s){console.error("Failed to move task:",s)}finally{u(!1)}}},r=[];if(a.dependsOn.length>0){const s=d?.tasks||[];a.dependsOn.some(D=>s.some(T=>T.taskId===D))&&r.push("This task has dependencies in the current milestone. Moving it may break the dependency chain.")}const p=t.flatMap(s=>s.tasks).filter(s=>s.dependsOn.includes(a.taskId)).filter(s=>d?.tasks.some(i=>i.taskId===s.taskId));return p.length>0&&r.push(`${p.length} task(s) in the current milestone depend on this task. Moving it may break their dependencies.`),e.jsx(w,{open:c,onOpenChange:o,children:e.jsxs(M,{className:"max-w-md",children:[e.jsxs(I,{children:[e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-purple-600"}),"Move Task to Milestone"]}),e.jsxs(S,{children:['Move "',a.name,'" from one milestone to another.']})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{className:"p-3 bg-muted/30 rounded-lg border",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(b,{className:"w-4 h-4 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Task Details:"}),e.jsxs("div",{className:"text-muted-foreground mt-1",children:["• Name: ",a.name,"• Duration: ",a.durationDays," days • Team: ",a.team,"• Dependencies: ",a.dependsOn.length]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"From Milestone"}),e.jsxs("div",{className:"p-2 bg-muted/20 rounded border",children:[e.jsx("div",{className:"font-medium",children:d?.milestoneName}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[d?.tasks.length," tasks total"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"To Milestone"}),h.length>0?e.jsxs(B,{value:l,onValueChange:g,children:[e.jsx(E,{children:e.jsx(O,{placeholder:"Select destination milestone"})}),e.jsx(V,{children:h.map(s=>e.jsx(W,{value:s.milestoneId,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:s.milestoneName}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",s.tasks.length," tasks)"]})]})},s.milestoneId))})]}):e.jsx("div",{className:"p-2 bg-muted/20 rounded border text-sm text-muted-foreground",children:"No other milestones available"})]}),j&&e.jsx("div",{className:"p-3 bg-muted/30 rounded-lg border",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(b,{className:"w-4 h-4 text-green-600 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Move Summary:"}),e.jsxs("div",{className:"text-muted-foreground mt-1",children:["• From: ",d?.milestoneName," →"," ",j.milestoneName,"• Task will maintain its duration and team assignment • Timeline will be recalculated after moving"]})]})]})}),r.length>0&&e.jsx("div",{className:"p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("div",{className:"font-medium",children:"Dependency Warnings:"}),e.jsx("ul",{className:"mt-1 space-y-1",children:r.map((s,i)=>e.jsxs("li",{className:"text-xs",children:["• ",s]},i))})]})]})})]}),e.jsxs(F,{children:[e.jsxs(v,{variant:"outline",onClick:o,disabled:m,children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(v,{onClick:k,disabled:m||!l||h.length===0,className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"}),m?"Moving...":"Move Task"]})]})]})})}export{G as MoveTaskDialog};
