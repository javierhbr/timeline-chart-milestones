import{r as x,j as e,am as f,B as N}from"./index-DeksGDDi.js";import{D as w,a as M,b as I,c as C,d as S,L as v,e as F}from"./label-BttNplgj.js";import{S as L,a as B,b as E,c as O,d as V}from"./select-VsNWQHqQ.js";import{C as b}from"./circle-check-big-DOqoCIid.js";import{C as W}from"./circle-alert-V_y01eYo.js";import{X as A}from"./x-Ds1ghz-F.js";import"./index-Dhp8sDxk.js";function P({isOpen:c,onClose:o,onConfirm:y,task:a,milestones:t,currentMilestoneId:n}){const[l,g]=x.useState(""),[m,p]=x.useState(!1);if(x.useEffect(()=>{if(a&&c){const s=t.filter(i=>i.milestoneId!==n);g(s.length>0?s[0].milestoneId:"")}},[a,c,n,t]),!a)return null;const d=t.find(s=>s.milestoneId===n),u=t.find(s=>s.milestoneId===l),h=t.filter(s=>s.milestoneId!==n),k=async()=>{if(!(!l||l===n)){p(!0);try{await y(n,l),o()}catch(s){console.error("Failed to move task:",s)}finally{p(!1)}}},r=[];if(a.dependsOn.length>0){const s=d?.tasks||[];a.dependsOn.some(D=>s.some(T=>T.taskId===D))&&r.push("This task has dependencies in the current milestone. Moving it may break the dependency chain.")}const j=t.flatMap(s=>s.tasks).filter(s=>s.dependsOn.includes(a.taskId)).filter(s=>d?.tasks.some(i=>i.taskId===s.taskId));return j.length>0&&r.push(`${j.length} task(s) in the current milestone depend on this task. Moving it may break their dependencies.`),e.jsx(w,{open:c,onOpenChange:o,children:e.jsxs(M,{className:"max-w-md",children:[e.jsxs(I,{children:[e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-purple-600"}),"Move Task to Milestone"]}),e.jsxs(S,{children:['Move "',a.name,'" from one milestone to another.']})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{className:"p-3 bg-muted/30 rounded-lg border",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(b,{className:"w-4 h-4 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Task Details:"}),e.jsxs("div",{className:"text-muted-foreground mt-1",children:["• Name: ",a.name,"• Duration: ",a.durationDays," days • Team: ",a.team,"• Dependencies: ",a.dependsOn.length]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"From Milestone"}),e.jsxs("div",{className:"p-2 bg-muted/20 rounded border",children:[e.jsx("div",{className:"font-medium",children:d?.milestoneName}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[d?.tasks.length," tasks total"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"To Milestone"}),h.length>0?e.jsxs(L,{value:l,onValueChange:g,children:[e.jsx(B,{children:e.jsx(E,{placeholder:"Select destination milestone"})}),e.jsx(O,{children:h.map(s=>e.jsx(V,{value:s.milestoneId,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:s.milestoneName}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",s.tasks.length," tasks)"]})]})},s.milestoneId))})]}):e.jsx("div",{className:"p-2 bg-muted/20 rounded border text-sm text-muted-foreground",children:"No other milestones available"})]}),u&&e.jsx("div",{className:"p-3 bg-muted/30 rounded-lg border",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(b,{className:"w-4 h-4 text-green-600 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Move Summary:"}),e.jsxs("div",{className:"text-muted-foreground mt-1",children:["• From: ",d?.milestoneName," →"," ",u.milestoneName,"• Task will maintain its duration and team assignment • Timeline will be recalculated after moving"]})]})]})}),r.length>0&&e.jsx("div",{className:"p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("div",{className:"font-medium",children:"Dependency Warnings:"}),e.jsx("ul",{className:"mt-1 space-y-1",children:r.map((s,i)=>e.jsxs("li",{className:"text-xs",children:["• ",s]},i))})]})]})})]}),e.jsxs(F,{children:[e.jsxs(N,{variant:"outline",onClick:o,disabled:m,children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(N,{onClick:k,disabled:m||!l||h.length===0,className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"}),m?"Moving...":"Move Task"]})]})]})})}export{P as MoveTaskDialog};
