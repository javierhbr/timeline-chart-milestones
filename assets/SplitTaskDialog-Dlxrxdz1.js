import{c as F,r as c,j as s,D as k,a as I,b as L,d as _,aF as D,e as A,L as f,B as m,P as q,I as b,f as B,X as M}from"./index-Bsg0-DuV.js";import{C as S}from"./circle-check-big-Cn_heOmx.js";import{C as w}from"./circle-alert-Bf5762JH.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M5 12h14",key:"1ays0h"}]],H=F("minus",z);function J({isOpen:u,onClose:h,onConfirm:C,task:t,_milestones:O}){const[r,n]=c.useState({splits:[{name:"",duration:1},{name:"",duration:1}]}),[p,N]=c.useState(!1),[x,g]=c.useState([]);if(c.useEffect(()=>{if(t&&u){const a=t.durationDays,e=2,i=Math.floor(a/e),l=a%e;n({splits:Array.from({length:e},(j,d)=>({name:`${t.name} - Part ${d+1}`,duration:i+(d<l?1:0)}))}),g([])}},[t,u]),!t)return null;const $=()=>{const a=[];r.splits.length<2&&a.push("At least 2 split tasks are required"),r.splits.forEach((i,l)=>{i.name.trim()||a.push(`Split task ${l+1} needs a name`),i.duration<1&&a.push(`Split task ${l+1} must have at least 1 day duration`)});const e=r.splits.reduce((i,l)=>i+l.duration,0);return e!==t.durationDays&&a.push(`Total duration (${e} days) must equal original task duration (${t.durationDays} days)`),a},T=async()=>{const a=$();if(a.length>0){g(a);return}N(!0);try{await C(r),h()}catch(e){console.error("Failed to split task:",e),g(["Failed to split task. Please try again."])}finally{N(!1)}},E=()=>{n(a=>({splits:[...a.splits,{name:`${t.name} - Part ${a.splits.length+1}`,duration:1}]}))},P=a=>{r.splits.length<=2||n(e=>({splits:e.splits.filter((i,l)=>l!==a)}))},v=(a,e,i)=>{n(l=>({splits:l.splits.map((j,d)=>d===a?{...j,[e]:i}:j)}))},y=r.splits.reduce((a,e)=>a+e.duration,0),o=y-t.durationDays;return s.jsx(k,{open:u,onOpenChange:h,children:s.jsxs(I,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[s.jsxs(L,{children:[s.jsxs(_,{className:"flex items-center gap-2",children:[s.jsx(D,{className:"w-5 h-5 text-orange-600"}),"Split Task"]}),s.jsxs(A,{children:['Split "',t.name,'" into multiple sequential tasks. Each split will depend on the previous one.']})]}),s.jsxs("div",{className:"space-y-4 py-4",children:[s.jsx("div",{className:"p-3 bg-muted/30 rounded-lg border",children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(S,{className:"w-4 h-4 text-blue-600 mt-0.5"}),s.jsxs("div",{className:"text-sm",children:[s.jsx("div",{className:"font-medium",children:"Original Task:"}),s.jsxs("div",{className:"text-muted-foreground mt-1",children:["• Name: ",t.name,"• Duration: ",t.durationDays," days • Team: ",t.team]})]})]})}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(f,{className:"text-base font-medium",children:"Split Tasks"}),s.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:E,className:"flex items-center gap-1",children:[s.jsx(q,{className:"w-4 h-4"}),"Add Split"]})]}),r.splits.map((a,e)=>s.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsxs("div",{children:[s.jsxs(f,{htmlFor:`split-name-${e}`,className:"text-sm",children:["Task ",e+1," Name"]}),s.jsx(b,{id:`split-name-${e}`,value:a.name,onChange:i=>v(e,"name",i.target.value),placeholder:`${t.name} - Part ${e+1}`})]}),s.jsxs("div",{className:"w-32",children:[s.jsx(f,{htmlFor:`split-duration-${e}`,className:"text-sm",children:"Duration (days)"}),s.jsx(b,{id:`split-duration-${e}`,type:"number",min:"1",value:a.duration,onChange:i=>v(e,"duration",parseInt(i.target.value)||1)})]})]}),r.splits.length>2&&s.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>P(e),className:"text-red-600 hover:text-red-700",children:s.jsx(H,{className:"w-4 h-4"})})]},e))]}),s.jsx("div",{className:`p-3 rounded-lg border ${o===0?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"}`,children:s.jsxs("div",{className:"flex items-start gap-2",children:[o===0?s.jsx(S,{className:"w-4 h-4 text-green-600 mt-0.5"}):s.jsx(w,{className:"w-4 h-4 text-yellow-600 mt-0.5"}),s.jsxs("div",{className:"text-sm",children:[s.jsx("div",{className:"font-medium",children:"Duration Summary:"}),s.jsxs("div",{className:"mt-1",children:["• Original: ",t.durationDays," days • Split total:"," ",y," days • Difference:"," ",o>0?"+":"",o," days"]})]})]})}),x.length>0&&s.jsx("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200",children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(w,{className:"w-4 h-4 text-red-600 mt-0.5"}),s.jsxs("div",{className:"text-sm text-red-800",children:[s.jsx("div",{className:"font-medium",children:"Please fix the following issues:"}),s.jsx("ul",{className:"mt-1 list-disc list-inside space-y-1",children:x.map((a,e)=>s.jsx("li",{children:a},e))})]})]})})]}),s.jsxs(B,{children:[s.jsxs(m,{variant:"outline",onClick:h,disabled:p,children:[s.jsx(M,{className:"w-4 h-4 mr-2"}),"Cancel"]}),s.jsxs(m,{onClick:T,disabled:p||x.length>0,className:"flex items-center gap-2",children:[s.jsx(D,{className:"w-4 h-4"}),p?"Splitting...":"Split Task"]})]})]})})}export{J as SplitTaskDialog};
